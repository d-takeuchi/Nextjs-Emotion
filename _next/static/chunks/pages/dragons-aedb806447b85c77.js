(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7254:function(a,b,c){"use strict";var d=c(9008),e=c.n(d),f=c(1664),g=c.n(f),h=c(1316),i={name:"8tasac",styles:"max-width:1200px;margin:0 auto;padding:0 4%;display:flex;justify-content:space-between"},j={name:"koy86a",styles:"display:flex;font-size:1.25rem;margin-top:34px;list-style:none;li{margin-left:36px;}a{color:#432;}a:hover{color:pink;}"},k={name:"6fp1ir",styles:"max-width:1200px;margin:0 auto;padding:0 4%"},l=function(a){var b=a.children,c=a.title;return(0,h.BX)("div",{children:[(0,h.tZ)(e(),{children:(0,h.tZ)("title",{children:c})}),(0,h.BX)("header",{css:[i,k,"",""],children:[(0,h.tZ)("h1",{children:"EmotionとReactQuery(GraphQL)を試す"}),(0,h.tZ)("nav",{children:(0,h.tZ)("ul",{css:j,children:(0,h.tZ)("li",{children:(0,h.tZ)(g(),{href:"/dragons",children:"React-Query-GraphQL"})})})})]}),(0,h.tZ)("main",{css:k,children:b})]})};b.Z=l},9013:function(a,b,c){"use strict";c.r(b),c.d(b,{default:function(){return R}});var d,e,f,g,h,i=c(1664),j=c.n(i),k=c(7294),l=c(29),m=c(7794),n=c.n(m),o=c(3471),p=c(8687),q=c.n(p),r=c(1383),s=(0,p.gql)(d||(d=(0,r.Z)(["\n  query GetDragon {\n    dragon {\n      id\n      name\n      description\n    }\n  }\n"]))),t=(0,p.gql)(e||(e=(0,r.Z)(["\n  mutation CreateDragon($name: String!, $description: String!) {\n    insert_dragon_one(object: { name: $name, description: $description }) {\n      id\n      name\n      description\n    }\n  }\n"]))),u=(0,p.gql)(f||(f=(0,r.Z)(["\n  mutation UpdateDragon($id: uuid!, $name: String!, $description: String!) {\n    update_dragon_by_pk(\n      pk_columns: { id: $id }\n      _set: { name: $name, description: $description }\n    ) {\n      id\n      name\n      description\n    }\n  }\n"]))),v=(0,p.gql)(g||(g=(0,r.Z)(["\n  mutation DeleteDragon($id: uuid!) {\n    delete_dragon_by_pk(id: $id) {\n      id\n      name\n      description\n    }\n  }\n"]))),w=c(3454),x=(h=(0,l.Z)(n().mark(function a(){var b,c;return n().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,q()(w.env.NEXT_PUBLIC_HASURA_ENDPOINT,s);case 2:return c=(b=a.sent).dragon,a.abrupt("return",c);case 5:case"end":return a.stop()}},a)})),function(){return h.apply(this,arguments)}),y=c(9473),z=c(6687),A=c(1893),B=c(3454),C=function(){var a=(0,o.useQueryClient)(),b=(0,y.I0)(),c=new p.GraphQLClient(B.env.NEXT_PUBLIC_HASURA_ENDPOINT),d=(0,o.useMutation)(function(a){var b=a.name,d=a.description;return c.request(t,{name:b,description:d})},{onSuccess:function(c){var d=a.getQueryData(["dragons"]);d&&a.setQueryData(["dragons"],[].concat((0,z.Z)(d),[c.insert_dragon_one])),b((0,A.sl)())}}),e=(0,o.useMutation)(function(a){return c.request(u,{id:a.id,name:a.name,description:a.decription})},{onSuccess:function(c,d){var e=a.getQueryData(["dragons"]);e&&a.setQueryData(["dragons"],e.map(function(a){return a.id===d.id?c.update_dragon_by_pk:a})),b((0,A.sl)())}}),f=(0,o.useMutation)(function(a){return c.request(v,{id:a})},{onSuccess:function(c,d){var e=a.getQueryData(["dragons"]);e&&a.setQueryData(["dragons"],e.filter(function(a){return a.id!==d})),b((0,A.sl)())}});return{createDragonMutation:d,updateDragonMutation:e,deleteDragonMutation:f}},D=c(4898),E=c(8354),F=c(1316),G={name:"8evcqa",styles:"cursor:pointer;width:1.25rem;height:1.25rem;margin:0 5px"},H=function(a){var b=a.dragon,c=(0,y.I0)(),d=C().deleteDragonMutation;return d.isLoading?(0,F.tZ)("p",{children:"削除中です..."}):(0,F.BX)("li",{children:[(0,F.tZ)("span",{children:b.name}),(0,F.tZ)("span",{children:b.description}),(0,F.tZ)(D.Z,{css:G,onClick:function(){c((0,A.CM)({id:b.id,name:b.name,decription:b.description}))}}),(0,F.tZ)(E.Z,{css:G,onClick:function(){d.mutate(b.id)}})]})},I=(0,k.memo)(H),J=function(){var a=(0,o.useQuery)(["dragons"],x),b=a.status,c=a.data;return"loading"===b?(0,F.tZ)("div",{children:"ロード中..."}):"error"===b?(0,F.tZ)("div",{children:"エラーです！"}):(0,F.tZ)("div",{children:null==c?void 0:c.map(function(a){return(0,F.tZ)("div",{children:(0,F.tZ)("ul",{children:(0,F.tZ)(I,{dragon:a})})},a.id)})})},K=(0,k.memo)(J),L=c(7254),M=c(9499);function N(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function O(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?N(Object(c),!0).forEach(function(b){(0,M.Z)(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):N(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}var P=function(){var a=(0,y.I0)(),b=(0,y.v9)(A.LG),c=C(),d=c.createDragonMutation,e=c.updateDragonMutation,f=function(a){a.preventDefault(),""===b.id?d.mutate({name:b.name,description:b.decription}):e.mutate(b)};return(0,F.tZ)("div",{children:(0,F.BX)("form",{onSubmit:f,children:[(0,F.tZ)("input",{placeholder:"ドラゴンの名前",type:"text",value:b.name,onChange:function(c){return a((0,A.CM)(O(O({},b),{},{name:c.target.value})))}}),(0,F.tZ)("input",{placeholder:"ドラゴンの説明文",type:"text",value:b.decription,onChange:function(c){return a((0,A.CM)(O(O({},b),{},{decription:c.target.value})))}}),(0,F.tZ)("button",{disabled:!b.name||!b.decription,children:""===b.id?"新規":"更新"})]})})},Q=(0,k.memo)(P),R=function(){return(0,F.BX)(L.Z,{title:"ドラゴン一覧",children:[(0,F.tZ)("h1",{children:"ドラゴン一覧"}),(0,F.tZ)(Q,{}),(0,F.tZ)(K,{}),(0,F.tZ)(j(),{href:"/",children:"ホームへ戻る"})]})}},3603:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dragons",function(){return c(9013)}])}},function(a){a.O(0,[996,661,774,888,179],function(){var b;return a(a.s=3603)}),_N_E=a.O()}])